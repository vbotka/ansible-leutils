---
# defaults vbotka.leutils

freebsd_install_method: "packages"
# freebsd_install_method: "ports"
freebsd_use_packages: "yes"

leutils_debug: False
leutils_ignore_lock: False

leutils_packages:
  - shells/bash
  - devel/git
  - security/py-certbot

# source
leutils_source_version: "0.3.6"
leutils_source_file: "{{ leutils_source_version }}.tar.gz"
leutils_source_checksum: "sha1:6600a057f2fe3dd528745a062164bb3bf1197954"
leutils_source_dir: "le-utils-{{ leutils_source_version }}"
leutils_source_dest: "/usr/local/src"
leutils_source_url: "https://github.com/vbotka/le-utils/archive"
leutils_unarchive_extra_opts: "--skip-old-files"

# directories, owner, group and permissions
leutils_owner: "root"
leutils_group: "wheel"
leutils_bin_dir: "/root/bin"
leutils_bin_dir_mode: "0755"
leutils_bin_mode: "0755"
leutils_config_mode: "0644"
leutils_LEROOT_mode: "0755"
leutils_LEROOT_live_mode: "0700"
leutils_fingerprint_mode: "0644"

# configure lectl
leutils_config_file: "/etc/le-utils"
leutils_config_file_owner: "root"
leutils_config_file_group: "wheel"
leutils_config_file_mode: "0644"
leutils_config_WEBSERVER: "APACHE"
leutils_config_LEROOT: "/usr/local/etc/letsencrypt"
leutils_config_LEROOTMTIMEPRESERVE: "1"
leutils_config_FINGERPRINTFILE: "{{ leutils_config_LEROOT }}/{{ leutils_fingerprint_file }}"

# create file with fingerprints of the certificates
leutils_fingerprint: True
leutils_fingerprint_file: "FINGERPRINT"
leutils_fingerprint_command: "{{ leutils_bin_dir }}/leinfo -g -a"

# configure cron
leutils_cron_user: "root"
leutils_cron_mailto: "root"

# cron list of certificates scheduled daily
leutils_days: "30"
leutils_days_enable: True
leutils_list_command: >
  "{{ leutils_bin_dir }}/leinfo -e --Days={{ leutils_days }} -a"
leutils_days_cron_hour: "2"
leutils_days_cron_minute: "15"

# cron dry-run renewal of certificates scheduled daily
leutils_dryrun: False
leutils_dryrun_command: "{{ leutils_bin_dir }}/lectl -s -n -c -a"
leutils_dryrun_cron_hour: "2"
leutils_dryrun_cron_minute: "20"
# NOTE: daily dry-run renewal is recommended
# https://community.letsencrypt.org/t/help-us-test-renewal-with-letsencrypt-renew/10562
# Command "/root/bin/lectl -n -c -a" will stop apache during renewal

# cron renewal of certificates when expiry in less then 30 days scheduled daily
leutils_renew: False
# leutils_renew_command: "{{ leutils_bin_dir }}/renew-certificates.sh"
leutils_renew_command: "{{ leutils_bin_dir }}/lectl -s -D=30 -c -a"
leutils_renew_cron_hour: "3"
leutils_renew_cron_minute: "20"

# EOF
...
